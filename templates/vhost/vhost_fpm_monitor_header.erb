<VirtualHost <%= listen_ip %>:<%= listen_port %>>
    ServerName <%= servername %>
<% if server_admin != '' -%>
    ServerAdmin <%= server_admin %>
<% end -%>
    DocumentRoot <%= document_root %>
    ErrorLog <%= errorlog %> 
    CustomLog <%= accesslog %> combined

<IfModule mod_fastcgi.c>
    AddHandler php5-fcgi .php
    Action php5-fcgi /php5-fcgi
    Alias /php5-fcgi /usr/lib/cgi-bin/<%= name.split('.').at(0) %>-<%= name.split('.').at(1) %>-monitor-php5-fcgi
    FastCgiExternalServer /usr/lib/cgi-bin/<%= name.split('.').at(0) %>-<%= name.split('.').at(1) %>-monitor-php5-fcgi <%= listen %>  -pass-header Authorization
    <LocationMatch "/(ping|fpm-status)">
        SetHandler php5-fcgi-virt
        Action php5-fcgi-virt /php5-fcgi virtual

        # .htpasswd generated by puppet
        AuthUserFile /var/www/.htpasswd
        AuthType Basic
        AuthName "<%= name.split('.').at(0) %> <%= name.split('.').at(1) %> status page"
        Require valid-user
    </LocationMatch>
</IfModule>
