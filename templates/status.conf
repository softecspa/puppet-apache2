#<%= scope.lookupvar('::template_header') %>

#
# Allow server status reports generated by mod_status,
# with the URL of http://servername/server-status
# Uncomment and change the ".example.com" to allow
# access from other hosts.
#

<IfModule mod_status.c>
    ExtendedStatus On

    <Location /server-status>
        SetHandler server-status

        <% @subnet_regex.each do |val| -%>
        SetEnvIF X-Forwarded-For "^<%= val %>" allow_forward_status
        <% end -%>

        SetEnvIF Remote_Protocol "^" is_direct=1
        SetEnvIf X-Forwarded-For "^[0-9].*" is_direct=0
        <% @subnet_regex.each do |val| -%>
        SetEnvIF Remote_Addr "^<%= val %>$" allow_direct_status
        <% end -%>
        SetEnvIf is_direct 0 !allow_direct_status

        Order deny,allow
        Deny from all
        Allow from localhost ip6-localhost
        Allow from env=allow_forward_status
        Allow from env=allow_direct_status
    </Location>

</IfModule>
